% ------------------------------------------------------------------------------
#single_pair_equals
:q
[value="chommoda"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_not_equals
:q
[value<>"chommoda"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value NEQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)<>LOWER('chommoda')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value NEQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)<>LOWER('chommoda')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_contains
:q
[value*="homm"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value CONTAINS "homm"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value) LIKE ('%' || LOWER('homm') || '%')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value CONTAINS "homm"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value) LIKE ('%' || LOWER('homm') || '%')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_starts_with
:q
[value^="ch"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value STARTSWITH "ch"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value) LIKE (LOWER('ch')|| '%')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value STARTSWITH "ch"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value) LIKE (LOWER('ch')|| '%')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_ends_with
:q
[value$="ter"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value ENDSWITH "ter"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value) LIKE ('%' || LOWER('ter'))
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value ENDSWITH "ter"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value) LIKE ('%' || LOWER('ter'))
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_wildcards
:q
[value?="c*ommod?"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value WILDCARDS "c*ommod?"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value) LIKE LOWER('c%ommod_')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value WILDCARDS "c*ommod?"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value) LIKE LOWER('c%ommod_')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_regex
:q
[value~="av(us|ia)"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value REGEXP "av(us|ia)"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  span.value ~ 'av(us|ia)'
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value REGEXP "av(us|ia)"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  span.value ~ 'av(us|ia)'
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_non_privileged
:q
[syl_n>"4"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: syl_n GT "4"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  EXISTS
  (
    SELECT * FROM span_attribute sa
    WHERE sa.span_id=span.id
    AND LOWER(sa.name)=LOWER('syl\_n')
    AND (SELECT (CASE pyt_is_numeric(value::varchar) WHEN true THEN value::double precision ELSE NULL END)) > 4
  )
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: syl_n GT "4"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  EXISTS
  (
    SELECT * FROM span_attribute sa
    WHERE sa.span_id=span.id
    AND LOWER(sa.name)=LOWER('syl\_n')
    AND (SELECT (CASE pyt_is_numeric(value::varchar) WHEN true THEN value::double precision ELSE NULL END)) > 4
  )
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_doc_single_pair
:q
@[author="Catullus"]; [value="chommoda"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  INNER JOIN document ON span.document_id=document.id
  WHERE
  -- doc begin
  (
  -- s1: author EQ "Catullus"
  LOWER(document.author)=LOWER('Catullus')
  )
  -- doc end
  AND
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  INNER JOIN document ON span.document_id=document.id
  WHERE
  -- doc begin
  (
  -- s1: author EQ "Catullus"
  LOWER(document.author)=LOWER('Catullus')
  )
  -- doc end
  AND
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#single_pair_doc_single_pair_non_privileged
:q
@[category="poetry"]; [value="chommoda"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  INNER JOIN document ON span.document_id=document.id
  INNER JOIN document_attribute ON span.document_id=document_attribute.document_id
  WHERE
  -- doc begin
  (
  -- s1: category EQ "poetry"
  LOWER(document_attribute.name)=LOWER('category') AND LOWER(document_attribute.value)=LOWER('poetry')
  )
  -- doc end
  AND
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  INNER JOIN document ON span.document_id=document.id
  INNER JOIN document_attribute ON span.document_id=document_attribute.document_id
  WHERE
  -- doc begin
  (
  -- s1: category EQ "poetry"
  LOWER(document_attribute.name)=LOWER('category') AND LOWER(document_attribute.value)=LOWER('poetry')
  )
  -- doc end
  AND
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
-- result
, r AS
(
SELECT s1.* FROM s1
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#two_pairs_or
:q
[value="chommoda"] OR [value="commoda"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
, s2 AS
(
  -- s2: value EQ "commoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(value)=LOWER('commoda')
) -- s2
-- result
, r AS
(
SELECT s1.* FROM s1
UNION
SELECT s2.* FROM s2
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
, s2 AS
(
  -- s2: value EQ "commoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)=LOWER('commoda')
) -- s2
-- result
, r AS
(
SELECT s1.* FROM s1
UNION
SELECT s2.* FROM s2
) -- r

-- merger
SELECT COUNT(*) FROM r

% ------------------------------------------------------------------------------
#two_pairs_and
:q
[value="chommoda"] AND [length>"5"]

:r
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
, s2 AS
(
  -- s2: length GT "5"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  (SELECT (CASE pyt_is_numeric(length::varchar) WHEN true THEN length::double precision ELSE NULL END)) > 5
) -- s2
-- result
, r AS
(
SELECT s1.* FROM s1
INTERSECT
SELECT s2.* FROM s2
) -- r

-- merger
SELECT DISTINCT
r.id,
r.document_id,
r.p1,
r.p2,
r.type,
r.index,
r.length,
r.value,
document.author,
document.title,
document.sort_key
FROM r
INNER JOIN document ON r.document_id=document.id
ORDER BY sort_key, p1
LIMIT 20 OFFSET 0

:c
-- CTE list
WITH s1 AS
(
  -- s1: value EQ "chommoda"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  LOWER(span.value)=LOWER('chommoda')
) -- s1
, s2 AS
(
  -- s2: length GT "5"
  SELECT DISTINCT
    span.id, span.document_id, span.type,
    span.p1, span.p2, span.index, span.length,
    span.value
  FROM span
  WHERE
  span.type='tok' AND
  (SELECT (CASE pyt_is_numeric(length::varchar) WHEN true THEN length::double precision ELSE NULL END)) > 5
) -- s2
-- result
, r AS
(
SELECT s1.* FROM s1
INTERSECT
SELECT s2.* FROM s2
) -- r

-- merger
SELECT COUNT(*) FROM r
